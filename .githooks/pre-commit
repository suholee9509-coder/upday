#!/bin/sh
#
# Pre-commit hook: Block sensitive and unnecessary files from being committed.
# Configured via: git config core.hooksPath .githooks
# Auto-configured on npm install via "prepare" script.
#

RED='\033[0;31m'
NC='\033[0m' # No Color

# Files/patterns that must NEVER be committed
BLOCKED_PATTERNS=(
  "^\.env$"
  "^\.env\."
  "^\.claude/"
  "^ref/"
  "^prd\.txt$"
  "^docs/prompts\.md$"
  "^DESIGN_BRIEF"
  "\.local$"
)

# Check staged files against blocked patterns
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
BLOCKED=0

for file in $STAGED_FILES; do
  for pattern in "${BLOCKED_PATTERNS[@]}"; do
    if echo "$file" | grep -qE "$pattern"; then
      echo "${RED}BLOCKED:${NC} $file (matches pattern: $pattern)"
      BLOCKED=1
    fi
  done
done

if [ $BLOCKED -ne 0 ]; then
  echo ""
  echo "${RED}Commit blocked.${NC} The files above must not be committed."
  echo "Use 'git reset HEAD <file>' to unstage, or 'git commit --no-verify' to bypass (not recommended)."
  exit 1
fi

exit 0
